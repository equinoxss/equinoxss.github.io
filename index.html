<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      overflow: hidden;
      background-color: black;
      font-family: sans-serif;
      font-size: 2rem;
      color: white;
      margin: 0;
    }

    .wrap {
      width: 100vw;
      height: 100vh;
      /* padding: 3%; */
      text-align: center;
      position: relative;
      box-sizing: border-box;
    }

    .black {
      width: 100%;
      height: 100%;
      background-color: black;
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .controls {
      padding: 3rem;
    }

    .radio-buttons {
      display: flex;
      gap: 3rem;
      justify-content: center;
      align-items: center;
      color: white;
      margin-top: 2rem;
      margin-bottom: 5rem;
      cursor: pointer;
    }

    .radio-buttons * {
      flex: 1;
    }

    .hidden {
      opacity: 0.15;
      pointer-events: none;
    }

    .button {
      width: 250px;
      height: 5rem;
      line-height: 5rem;
      border: 1px solid white;
      border-radius: 1rem;
      margin: 0 auto;
      cursor: pointer;
    }

    .radio {
      max-width: 120px;
    }

    .radio:not(.selected) {
      filter: opacity(0.5) grayscale(0.3);
    }

    .radio img {
      width: 100%;
      border-radius: 1rem;
      pointer-events: none;
    }

    .radio.small-img img {
      width: 47%;
    }

    .card-time {
      margin-bottom: 70px;
    }

    .card-time div {
      border: 1px solid rgba(255,255,255,0.5);
      padding: 20px 40px;
      border-radius: 1rem;
      display: inline-block;
    }

    .card-time div + div {
      margin-left: 2rem;
    }

    .card-time input {
      width: 50px;
      font-size: inherit;
      border-radius: 4px;
      border: none;
    }

  </style>
</head>
<body>
  <div class="wrap">
    <div class="black">
      <div class="controls">
        <div>Card Style</div>
        <div class="radio-buttons count">
          <div class="radio selected" data-id="s">
            <img src="imgs/land.jpg" />
            <div class="label">Singles</div>
          </div>
          <div class="radio" data-id="d">
            <img src="imgs/2earthWater.jpeg" />
            <div class="label">Doubles</div>
          </div>
          <div class="radio small-img" data-id="p">
            <img src="imgs/2earthFire.jpeg" />
            <img src="imgs/2fireLand.jpeg" />
            <div class="label">Pairs</div>
          </div>
        </div>  

        <div class="hidden" id="select-deck">
          <div>Card Deck</div>
          <div class="radio-buttons deck">
            <div class="radio selected" data-id="land">
              <img src="imgs/land.jpg" />
              <div class="label">Land</div>                
            </div>
            <div class="radio" data-id="water">
              <img src="imgs/water.jpg" />
              <div class="label">Water</div>
            </div>
            <div class="radio" data-id="fire">
              <img src="imgs/fire.jpg" />
              <div class="label">Fire</div>
            </div>
            <div class="radio" data-id="wind">
              <img src="imgs/wind.jpg" />
              <div class="label">Wind</div>
            </div>
            <div class="radio" data-id="ether">
              <img src="imgs/ether.jpg" />
              <div class="label">Ether</div>
            </div>
          </div>
        </div>
        <div class="card-time">
          <div>Card time: <input type="number" id="cardTime" min="1" max="60" /> mins</div>
          <div>Visualization time: <input type="number" id="vizTime" min="1" max="60" /> mins</div>
        </div>
        <div class="button" onclick="start()">Start</div>
      </div>
    </div>
  </div>

  <script>
    let cardTime = 120000;
    let blackTime = 180000;
    const bellTime = 2000;

    let audio = null;

    var segments = [];
    const singles = [ 'imgs/land.jpg', 'imgs/water.jpg', 'imgs/fire.jpg', 'imgs/wind.jpg', 'imgs/ether.jpg' ];
    const decks = {
      land: { i: 'imgs/land.jpg', c: [ 'imgs/land.jpg', 'imgs/2earthWater.jpeg', 'imgs/2earthFire.jpeg', 'imgs/2earthWind.jpeg', 'imgs/2earthEther.jpeg' ] },
      water: { i: 'imgs/water.jpg', c: [ 'imgs/water.jpg', 'imgs/2waterLand.jpeg', 'imgs/2waterFire.jpeg', 'imgs/2waterWind.jpeg', 'imgs/2waterEther.jpeg' ] },
      fire: { i: 'imgs/fire.jpg', c: [ 'imgs/fire.jpg', 'imgs/2fireLand.jpeg', 'imgs/2fireWater.jpeg', 'imgs/2fireWind.jpeg', 'imgs/2fireEther.jpeg' ] },
      wind: { i: 'imgs/wind.jpg', c: [ 'imgs/wind.jpg', 'imgs/2windLand.jpeg', 'imgs/2windWater.jpeg', 'imgs/2windFire.jpeg', 'imgs/2windEther.jpeg' ] },
      ether: { i: 'imgs/ether.jpg', c: [ 'imgs/ether.jpg', 'imgs/2etherLand.jpeg', 'imgs/2etherWater.jpeg', 'imgs/2etherFire.jpeg', 'imgs/2etherWind.jpeg' ] },
    };

    function start() {
      audio = new Audio();
      audio.autoplay = true;
      playSilent();

      cardTime = document.querySelector('#cardTime').value * 60000;
      blackTime = document.querySelector('#vizTime').value * 60000;

      const el = document.querySelector('.controls');
      document.querySelector('.black').removeChild(el);
      buildSegments();
      next();
    }

    function buildSegments() {
      const images = countChosen === 's' ? singles : decks[deckChosen].c;

      images.forEach(img => {
        segments.push({ i: img, t: cardTime });
        segments.push({ t: blackTime, b: true });
      });

      segments.push({ i: 'imgs/commun.jpg', t: cardTime });
      segments.push({ t: blackTime, b: true });
      segments.push({ done: true });
    }

    function next() {
      const el = document.querySelector('.black');
      const s = segments.shift();

      el.style.backgroundImage = s.i ? `url(${s.i})` : null;

      s.t && setTimeout(() => next(), s.t);
      s.b && setTimeout(() => playChime(), s.t - 1000);
      s.done && window.location.reload();
    }

    function playSilent() {
      audio.src = 'data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV';
    }

    function playChime() {
      audio.src = 'sounds/bell.mp3';

      setTimeout(() => playSilent(), bellTime);
    }

    function chooseType(evt, type) {
      if (type !== countChosen) {
        countChosen = type;

        document.querySelector('.radio-buttons.count').classList.toggle('selected');
        document.querySelector('.radio-buttons.deck').classList.toggle('selected');

        countChosen === 'd'
          ? selectDeck.classList.remove('hidden')
          : selectDeck.classList.add('hidden');
      }
    }

    const countButtons = document.querySelectorAll('.radio-buttons.count .radio')
    const deckButtons = document.querySelectorAll('.radio-buttons.deck .radio');
    const selectDeck = document.querySelector('#select-deck');

    let countChosen = 's';
    let deckChosen = 'land';

    for (const radioButton of countButtons) {
      radioButton.addEventListener('click', evt => {
        const newVal = evt.target.dataset.id;
        if (newVal !== countChosen) {
          countChosen = newVal;
          countChosen === 'd'
            ? selectDeck.classList.remove('hidden')
            : selectDeck.classList.add('hidden');

          countButtons.forEach( btn => btn.classList.remove('selected') );
          evt.target.classList.add('selected');
        }
      });
    }

    for (const radioButton of deckButtons) {
      radioButton.addEventListener('click', evt => {
        const newVal = evt.target.dataset.id;
        if (newVal !== deckChosen) {
          deckChosen = newVal;

          deckButtons.forEach( btn => btn.classList.remove('selected') );
          evt.target.classList.add('selected');
        }
      });
    }

    document.querySelector('#cardTime').value = cardTime / 60000;
    document.querySelector('#vizTime').value = blackTime / 60000;

  </script>
</body>
</html>